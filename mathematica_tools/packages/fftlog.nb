(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     12557,        298]
NotebookOptionsPosition[     11831,        277]
NotebookOutlinePosition[     12256,        294]
CellTagsIndexPosition[     12213,        291]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"BeginPackage", "[", "\"\<fftlog`\>\"", "]"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"q0kmqmuqdecomp", "::", "usage"}], "=", 
     "\"\<decompose expression into sum of powers of q0, kmq and muq \>\""}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"n1", "::", "usage"}], "=", 
     "\"\<fftlog index from first power spectrum\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"n2", "::", "usage"}], "=", 
     "\"\<fftlog index from second power spectrum\>\""}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Get", "[", 
     RowBox[{
      RowBox[{"NotebookDirectory", "[", "]"}], "<>", "\"\<globalvars.m\>\""}],
      "]"}], " ", ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Get", "[", 
     RowBox[{
      RowBox[{"NotebookDirectory", "[", "]"}], "<>", "\"\<util.m\>\""}], 
     "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Get", "[", 
     RowBox[{
      RowBox[{"NotebookDirectory", "[", "]"}], "<>", 
      "\"\<losintegrals.m\>\""}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Get", "[", 
     RowBox[{
      RowBox[{"NotebookDirectory", "[", "]"}], "<>", 
      "\"\<losintcalcs.m\>\""}], "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "decompose", " ", "an", " ", "expression", " ", "into", " ", "powers", 
      " ", "of", " ", "k0"}], ",", "q0", ",", "kmq", ",", "muk", ",", 
     RowBox[{
     "muq", " ", "\[IndentingNewLine]", "then", " ", "get", " ", "result", 
      " ", "of", " ", "integration", " ", "using", " ", "master", " ", "and", 
      " ", "line", " ", "of", " ", "sight", " ", "integrals", " ", "using", 
      " ", "the", " ", "losint", " ", "function", " ", "from", " ", 
      RowBox[{"losintcalcs", ".", "m"}]}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"q0kmqmuqdecomp", "[", "v0_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"v", "=", "v0"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"v", "=", 
        RowBox[{"Expand", "[", 
         RowBox[{"Simplfunc", "[", "v", "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"v", "=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Head", "[", "v", "]"}], "===", "Plus"}], ",", 
            RowBox[{"List", "@@", "v"}], ",", 
            RowBox[{"{", "v", "}"}]}], "]"}]}], ";"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Tv", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", " ", 
           RowBox[{
            RowBox[{"q0", " ", 
             RowBox[{
              RowBox[{"D", "[", 
               RowBox[{
                RowBox[{"v", "[", 
                 RowBox[{"[", "l", "]"}], "]"}], ",", "q0"}], "]"}], "/", 
              RowBox[{"v", "[", 
               RowBox[{"[", "l", "]"}], "]"}]}]}], ",", 
            RowBox[{"kmq", " ", 
             RowBox[{
              RowBox[{"D", "[", 
               RowBox[{
                RowBox[{"v", "[", 
                 RowBox[{"[", "l", "]"}], "]"}], ",", "kmq"}], "]"}], "/", 
              RowBox[{"v", "[", 
               RowBox[{"[", "l", "]"}], "]"}]}]}], ",", 
            RowBox[{"muq", " ", 
             RowBox[{
              RowBox[{"D", "[", 
               RowBox[{
                RowBox[{"v", "[", 
                 RowBox[{"[", "l", "]"}], "]"}], ",", "muq"}], "]"}], "/", 
              RowBox[{"v", "[", 
               RowBox[{"[", "l", "]"}], "]"}]}]}], ",", 
            RowBox[{
             RowBox[{"v", "[", 
              RowBox[{"[", "l", "]"}], "]"}], "/.", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"q0", "->", "1"}], ",", 
               RowBox[{"kmq", "->", "1"}], ",", 
               RowBox[{"muq", "->", "1"}]}], "}"}]}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"l", ",", "1", ",", 
            RowBox[{"Length", "[", "v", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"grouped", "=", 
        RowBox[{"GroupBy", "[", 
         RowBox[{"Tv", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"1", ",", "2", ",", "3"}], "}"}], "]"}], "]"}], "&"}], 
           "->", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "4", "]"}], "]"}], "&"}], ")"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"groupedSums", "=", 
        RowBox[{"KeyValueMap", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"#1", "->", 
            RowBox[{"Total", "[", "#2", "]"}]}], "&"}], ",", "grouped"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Tuniq", "=", 
        RowBox[{"Flatten", "/@", 
         RowBox[{"List", "@@@", 
          RowBox[{"Normal", "@", "groupedSums"}]}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"res", "=", 
        RowBox[{"Sum", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Tuniq", "[", 
            RowBox[{"[", 
             RowBox[{"m", ",", "4"}], "]"}], "]"}], " ", 
           RowBox[{"losint", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"-", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Tuniq", "[", 
                   RowBox[{"[", 
                    RowBox[{"m", ",", "1"}], "]"}], "]"}], "-", 
                  RowBox[{"Tuniq", "[", 
                   RowBox[{"[", 
                    RowBox[{"m", ",", "3"}], "]"}], "]"}]}], ")"}]}], "/", 
               "2"}], "+", "n1"}], ",", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"-", 
                RowBox[{"Tuniq", "[", 
                 RowBox[{"[", 
                  RowBox[{"m", ",", "2"}], "]"}], "]"}]}], "/", "2"}], "+", 
              "n2"}], ",", 
             RowBox[{"Tuniq", "[", 
              RowBox[{"[", 
               RowBox[{"m", ",", "3"}], "]"}], "]"}]}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"m", ",", "1", ",", 
            RowBox[{"Length", "[", "Tuniq", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Collect", "[", 
        RowBox[{"res", ",", "muk"}], "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"End", "[", "]"}], " ", "\n", "\[IndentingNewLine]", 
   RowBox[{"EndPackage", "[", "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.928913176868931*^9, 3.9289131959720097`*^9}, {
   3.928913314707378*^9, 3.928913315426022*^9}, {3.928915183708095*^9, 
   3.928915293660582*^9}, {3.9289163409793677`*^9, 3.9289163443087893`*^9}, 
   3.928920404560717*^9, 3.928921831912283*^9, {3.928982275626141*^9, 
   3.928982357526017*^9}, {3.928982517973412*^9, 3.928982521894602*^9}, {
   3.928984230692706*^9, 3.928984231550432*^9}, {3.928984268933331*^9, 
   3.9289842716594276`*^9}, {3.928984558071879*^9, 3.9289845661546392`*^9}, {
   3.928985490726593*^9, 3.928985491164998*^9}, {3.928985688978036*^9, 
   3.928985738552628*^9}, {3.92900603142797*^9, 3.92900608294218*^9}, {
   3.929006137420521*^9, 3.929006168119762*^9}, {3.929006198424901*^9, 
   3.929006201825329*^9}, {3.9290066099319267`*^9, 3.929006872398316*^9}, {
   3.929007080665165*^9, 3.929007080696939*^9}, {3.929007124979517*^9, 
   3.929007126430771*^9}, {3.929007382280937*^9, 3.929007385186458*^9}, {
   3.9297009759641848`*^9, 3.929701001155827*^9}, {3.929701257489936*^9, 
   3.929701268443241*^9}, {3.929701307639844*^9, 3.9297013224810147`*^9}, {
   3.9297013706871037`*^9, 3.9297013955847063`*^9}, 3.9297014613023376`*^9, {
   3.9297018109023957`*^9, 3.929701817876051*^9}, {3.929759589935487*^9, 
   3.929759606465978*^9}, {3.929759665680101*^9, 3.929759738181138*^9}, {
   3.929759782220747*^9, 3.929759787449587*^9}, 3.929759870362609*^9, {
   3.929761990037768*^9, 3.9297620154027033`*^9}, {3.929762048303605*^9, 
   3.929762065293209*^9}, {3.929763900329754*^9, 3.929763935906198*^9}, {
   3.929764130279497*^9, 3.929764304620513*^9}, {3.929764400268422*^9, 
   3.92976443883668*^9}, {3.929764483633724*^9, 3.929764518600279*^9}, 
   3.929764889080122*^9, {3.929764950603389*^9, 3.929764956980021*^9}, {
   3.9297651144016843`*^9, 3.929765120792914*^9}, 3.929765160427799*^9, {
   3.929765229802082*^9, 3.929765307207093*^9}, {3.929765354984042*^9, 
   3.929765382473502*^9}, {3.929765422142181*^9, 3.929765493863723*^9}, {
   3.93081559414935*^9, 
   3.93081559681747*^9}},ExpressionUUID->"085b4efb-2d89-4e05-9add-\
b0d3596c3972"],

Cell[BoxData["\<\"fftlog`\"\>"], "Output",
 CellChangeTimes->{
  3.9289133370277843`*^9, 3.928915296655786*^9, 3.928916349079134*^9, 
   3.9289164744862633`*^9, {3.928920415273674*^9, 3.928920416651155*^9}, {
   3.928921837125767*^9, 3.928921838796833*^9}, {3.9289823677930613`*^9, 
   3.928982369058281*^9}, 3.928984277684703*^9, 3.928984477500628*^9, 
   3.928984579313613*^9, 3.928984681575038*^9, 3.928985495113267*^9, 
   3.9289855558678617`*^9, {3.9289857435771*^9, 3.928985745415141*^9}, {
   3.929006902829905*^9, 3.929006907216928*^9}, 3.929007127375583*^9, 
   3.929007389027973*^9, 3.9297013309096107`*^9},
 CellLabel->
  "Out[252]=",ExpressionUUID->"df67ec3a-d994-407e-9680-3e83be1e1e0a"],

Cell[BoxData["\<\"fftlog`Private`\"\>"], "Output",
 CellChangeTimes->{
  3.9289133370277843`*^9, 3.928915296655786*^9, 3.928916349079134*^9, 
   3.9289164744862633`*^9, {3.928920415273674*^9, 3.928920416651155*^9}, {
   3.928921837125767*^9, 3.928921838796833*^9}, {3.9289823677930613`*^9, 
   3.928982369058281*^9}, 3.928984277684703*^9, 3.928984477500628*^9, 
   3.928984579313613*^9, 3.928984681575038*^9, 3.928985495113267*^9, 
   3.9289855558678617`*^9, {3.9289857435771*^9, 3.928985745415141*^9}, {
   3.929006902829905*^9, 3.929006907216928*^9}, 3.929007127375583*^9, 
   3.929007389027973*^9, 3.929701330914864*^9},
 CellLabel->
  "Out[256]=",ExpressionUUID->"3f62dd61-8eea-4120-b475-0b7326c7fc1e"],

Cell[BoxData["\<\"fftlog`Private`\"\>"], "Output",
 CellChangeTimes->{
  3.9289133370277843`*^9, 3.928915296655786*^9, 3.928916349079134*^9, 
   3.9289164744862633`*^9, {3.928920415273674*^9, 3.928920416651155*^9}, {
   3.928921837125767*^9, 3.928921838796833*^9}, {3.9289823677930613`*^9, 
   3.928982369058281*^9}, 3.928984277684703*^9, 3.928984477500628*^9, 
   3.928984579313613*^9, 3.928984681575038*^9, 3.928985495113267*^9, 
   3.9289855558678617`*^9, {3.9289857435771*^9, 3.928985745415141*^9}, {
   3.929006902829905*^9, 3.929006907216928*^9}, 3.929007127375583*^9, 
   3.929007389027973*^9, 3.929701331346941*^9},
 CellLabel->
  "Out[261]=",ExpressionUUID->"0c77a1ca-4002-49b6-befd-dc854eb54df2"]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
WindowSize->{693, 762},
WindowMargins->{{Automatic, 0}, {0, Automatic}},
FrontEndVersion->"14.0 for Linux x86 (64-bit) (December 12, 2023)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"d2f79bc3-21ee-4074-bce1-9f7e60c03b13"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 9114, 213, 823, "Input",ExpressionUUID->"085b4efb-2d89-4e05-9add-b0d3596c3972",
 InitializationCell->True],
Cell[9697, 237, 700, 11, 33, "Output",ExpressionUUID->"df67ec3a-d994-407e-9680-3e83be1e1e0a"],
Cell[10400, 250, 706, 11, 33, "Output",ExpressionUUID->"3f62dd61-8eea-4120-b475-0b7326c7fc1e"],
Cell[11109, 263, 706, 11, 33, "Output",ExpressionUUID->"0c77a1ca-4002-49b6-befd-dc854eb54df2"]
}, Open  ]]
}
]
*)

